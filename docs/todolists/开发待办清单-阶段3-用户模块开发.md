# å¼€å‘å¾…åŠæ¸…å• - é˜¶æ®µ3ï¼šç”¨æˆ·æ¨¡å—å¼€å‘

## ğŸ“‹ ä»»åŠ¡æ€»è§ˆ

æœ¬é˜¶æ®µåŒ…æ‹¬3ä¸ªä»»åŠ¡ï¼Œé¢„è®¡è€—æ—¶ï¼š3-5å¤©

---

## âœ… ä»»åŠ¡åˆ—è¡¨

### ä»»åŠ¡10ï¼šåˆ›å»ºUserMapperæ¥å£å’ŒXML
- **ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜
- **é¢„è®¡æ—¶é—´**ï¼š4å°æ—¶
- **è´Ÿè´£äºº**ï¼šåç«¯å¼€å‘äººå‘˜
- **çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹

#### å…·ä½“æ­¥éª¤
1. [ ] åˆ›å»º `mapper` åŒ…
2. [ ] åˆ›å»º `UserMapper.java` æ¥å£
3. [ ] åˆ›å»º `mapper/UserMapper.xml` æ˜ å°„æ–‡ä»¶
4. [ ] å®ç°åŸºç¡€çš„CRUDæ–¹æ³•

#### UserMapperæ¥å£
```java
package com.starwar.mapper;

import com.starwar.entity.User;
import org.apache.ibatis.annotations.Mapper;

@Mapper
public interface UserMapper {
    // æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·
    User selectByUsername(String username);
    
    // æ ¹æ®é‚®ç®±æŸ¥è¯¢ç”¨æˆ·
    User selectByEmail(String email);
    
    // æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·
    User selectById(Long id);
    
    // æ’å…¥æ–°ç”¨æˆ·
    int insert(User user);
    
    // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
    int update(User user);
}
```

#### UserMapper.xmlç¤ºä¾‹
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.starwar.mapper.UserMapper">
    
    <select id="selectByUsername" resultType="com.starwar.entity.User">
        SELECT * FROM user WHERE username = #{username}
    </select>
    
    <select id="selectByEmail" resultType="com.starwar.entity.User">
        SELECT * FROM user WHERE email = #{email}
    </select>
    
    <select id="selectById" resultType="com.starwar.entity.User">
        SELECT * FROM user WHERE id = #{id}
    </select>
    
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO user(username, password, email, nickname)
        VALUES(#{username}, #{password}, #{email}, #{nickname})
    </insert>
    
    <update id="update">
        UPDATE user
        SET nickname = #{nickname}, avatar = #{avatar}
        WHERE id = #{id}
    </update>
</mapper>
```

#### éªŒæ”¶æ ‡å‡†
- âœ… UserMapperæ¥å£æ–¹æ³•å®šä¹‰å®Œæ•´
- âœ… XMLæ˜ å°„æ–‡ä»¶é…ç½®æ­£ç¡®
- âœ… èƒ½å¤Ÿé€šè¿‡IDEA Mapperå·¥å…·æµ‹è¯•æŸ¥è¯¢
- âœ… å‚æ•°ç»‘å®šæ­£ç¡®

---

### ä»»åŠ¡11ï¼šå®ç°UserServiceä¸šåŠ¡é€»è¾‘
- **ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜
- **é¢„è®¡æ—¶é—´**ï¼š1å¤©
- **è´Ÿè´£äºº**ï¼šåç«¯å¼€å‘äººå‘˜
- **çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹

#### å…·ä½“æ­¥éª¤
1. [ ] åˆ›å»º `service` åŒ…
2. [ ] åˆ›å»º `UserService.java` æ¥å£
3. [ ] åˆ›å»º `impl/UserServiceImpl.java` å®ç°ç±»
4. [ ] å®ç°ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
5. [ ] å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½
6. [ ] å®ç°å¯†ç åŠ å¯†å’ŒéªŒè¯
7. [ ] å®ç°JWT Tokenç”Ÿæˆ

#### UserServiceæ¥å£
```java
package com.starwar.service;

import com.starwar.dto.RegisterDTO;
import com.starwar.dto.LoginDTO;
import com.starwar.vo.UserVO;

public interface UserService {
    // ç”¨æˆ·æ³¨å†Œ
    void register(RegisterDTO registerDTO);
    
    // ç”¨æˆ·ç™»å½•
    String login(LoginDTO loginDTO);
    
    // è·å–ç”¨æˆ·ä¿¡æ¯
    UserVO getUserInfo(Long userId);
}
```

#### UserServiceImplå®ç°ç¤ºä¾‹
```java
package com.starwar.service.impl;

import com.starwar.entity.User;
import com.starwar.mapper.UserMapper;
import com.starwar.service.UserService;
import com.starwar.dto.RegisterDTO;
import com.starwar.dto.LoginDTO;
import com.starwar.util.JwtUtil;
import com.starwar.util.PasswordUtil;
import com.starwar.common.Result;
import com.starwar.common.ResultCode;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl implements UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    @Override
    public void register(RegisterDTO registerDTO) {
        // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
        if (userMapper.selectByUsername(registerDTO.getUsername()) != null) {
            throw new RuntimeException("ç”¨æˆ·åå·²å­˜åœ¨");
        }
        
        // æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
        if (userMapper.selectByEmail(registerDTO.getEmail()) != null) {
            throw new RuntimeException("é‚®ç®±å·²è¢«æ³¨å†Œ");
        }
        
        // åˆ›å»ºç”¨æˆ·
        User user = new User();
        user.setUsername(registerDTO.getUsername());
        user.setPassword(PasswordUtil.encode(registerDTO.getPassword()));
        user.setEmail(registerDTO.getEmail());
        user.setNickname(registerDTO.getNickname());
        
        userMapper.insert(user);
    }
    
    @Override
    public String login(LoginDTO loginDTO) {
        // æŸ¥è¯¢ç”¨æˆ·
        User user = userMapper.selectByUsername(loginDTO.getUsername());
        if (user == null) {
            throw new RuntimeException("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        }
        
        // éªŒè¯å¯†ç 
        if (!PasswordUtil.matches(loginDTO.getPassword(), user.getPassword())) {
            throw new RuntimeException("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        }
        
        // ç”ŸæˆToken
        return JwtUtil.generateToken(user.getId(), user.getUsername());
    }
    
    @Override
    public UserVO getUserInfo(Long userId) {
        User user = userMapper.selectById(userId);
        // è½¬æ¢ä¸ºVOè¿”å›
        UserVO vo = new UserVO();
        vo.setId(user.getId());
        vo.setUsername(user.getUsername());
        vo.setNickname(user.getNickname());
        vo.setAvatar(user.getAvatar());
        return vo;
    }
}
```

#### éªŒæ”¶æ ‡å‡†
- âœ… æ³¨å†ŒåŠŸèƒ½æ­£ç¡®å®ç°ï¼ŒåŒ…å«é‡å¤æ£€æŸ¥
- âœ… ç™»å½•åŠŸèƒ½æ­£ç¡®å®ç°ï¼Œè¿”å›JWT Token
- âœ… å¯†ç æ­£ç¡®åŠ å¯†å­˜å‚¨
- âœ… å¯†ç éªŒè¯é€»è¾‘æ­£ç¡®
- âœ… å¼‚å¸¸å¤„ç†å®Œå–„

---

### ä»»åŠ¡12ï¼šåˆ›å»ºAuthControllerå¤„ç†è¯·æ±‚
- **ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜
- **é¢„è®¡æ—¶é—´**ï¼š4å°æ—¶
- **è´Ÿè´£äºº**ï¼šåç«¯å¼€å‘äººå‘˜
- **çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹

#### å…·ä½“æ­¥éª¤
1. [ ] åˆ›å»º `controller` åŒ…
2. [ ] åˆ›å»º `AuthController.java`
3. [ ] å®ç°æ³¨å†Œæ¥å£
4. [ ] å®ç°ç™»å½•æ¥å£
5. [ ] åˆ›å»ºDTOå’ŒVOç±»
6. [ ] é…ç½®ç»Ÿä¸€å¼‚å¸¸å¤„ç†

#### AuthControllerç¤ºä¾‹
```java
package com.starwar.controller;

import com.starwar.dto.RegisterDTO;
import com.starwar.dto.LoginDTO;
import com.starwar.service.UserService;
import com.starwar.common.Result;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/v1/auth")
public class AuthController {
    
    @Autowired
    private UserService userService;
    
    @PostMapping("/register")
    public Result<?> register(@RequestBody RegisterDTO registerDTO) {
        userService.register(registerDTO);
        return Result.success(null);
    }
    
    @PostMapping("/login")
    public Result<?> login(@RequestBody LoginDTO loginDTO) {
        String token = userService.login(loginDTO);
        return Result.success(token);
    }
}
```

#### DTOç±»ç¤ºä¾‹
```java
package com.starwar.dto;

import lombok.Data;

@Data
public class RegisterDTO {
    private String username;
    private String password;
    private String email;
    private String nickname;
}

@Data
public class LoginDTO {
    private String username;
    private String password;
}
```

#### éªŒæ”¶æ ‡å‡†
- âœ… æ³¨å†Œæ¥å£å¯ä»¥æ­£å¸¸è®¿é—®
- âœ… ç™»å½•æ¥å£è¿”å›æ­£ç¡®çš„Token
- âœ… è¯·æ±‚å‚æ•°éªŒè¯æ­£ç¡®
- âœ… ç»Ÿä¸€è¿”å›æ ¼å¼
- âœ… å¼‚å¸¸å¤„ç†è¿”å›å‹å¥½æç¤º

---

## ğŸ“Š é˜¶æ®µè¿›åº¦ç»Ÿè®¡

- **å·²å®Œæˆä»»åŠ¡**ï¼š0 / 3
- **è¿›è¡Œä¸­ä»»åŠ¡**ï¼š0 / 3
- **å¾…å¼€å§‹ä»»åŠ¡**ï¼š3 / 3
- **æ•´ä½“è¿›åº¦**ï¼š0%

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å®‰å…¨æ€§**ï¼šå¯†ç ç»ä¸è¿”å›ç»™å‰ç«¯
2. **å¼‚å¸¸å¤„ç†**ï¼šä½¿ç”¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨
3. **å‚æ•°éªŒè¯**ï¼šä½¿ç”¨@Validè¿›è¡Œå‚æ•°æ ¡éªŒ
4. **Tokenç®¡ç†**ï¼šè®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
5. **ä»£ç è§„èŒƒ**ï¼šéµå¾ªRESTful APIè®¾è®¡è§„èŒƒ

---

## ğŸ¯ å®Œæˆæ ‡å¿—

å½“ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶æ»¡è¶³æ—¶ï¼Œé˜¶æ®µ3å®Œæˆï¼š
- âœ… ç”¨æˆ·èƒ½å¤ŸæˆåŠŸæ³¨å†Œ
- âœ… ç”¨æˆ·èƒ½å¤ŸæˆåŠŸç™»å½•å¹¶è·å–Token
- âœ… Tokenèƒ½å¤Ÿæ­£ç¡®è§£æå‡ºç”¨æˆ·ä¿¡æ¯
- âœ… ä½¿ç”¨Postmanæµ‹è¯•é€šè¿‡æ‰€æœ‰æ¥å£

---

**ä¸Šä¸€é˜¶æ®µ**ï¼š[é˜¶æ®µ2ï¼šåŸºç¡€æ¡†æ¶æ­å»º](å¼€å‘å¾…åŠæ¸…å•-é˜¶æ®µ2-åŸºç¡€æ¡†æ¶æ­å»º.md)  
**ä¸‹ä¸€é˜¶æ®µ**ï¼š[é˜¶æ®µ4ï¼šæ¸¸æˆè®°å½•æ¨¡å—å¼€å‘](å¼€å‘å¾…åŠæ¸…å•-é˜¶æ®µ4-æ¸¸æˆè®°å½•æ¨¡å—.md)

