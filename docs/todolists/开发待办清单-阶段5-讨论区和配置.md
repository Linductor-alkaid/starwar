# å¼€å‘å¾…åŠæ¸…å• - é˜¶æ®µ5ï¼šè®¨è®ºåŒºæ¨¡å—å’Œç³»ç»Ÿé…ç½®

## ğŸ“‹ ä»»åŠ¡æ€»è§ˆ

æœ¬é˜¶æ®µåŒ…æ‹¬5ä¸ªä»»åŠ¡ï¼Œé¢„è®¡è€—æ—¶ï¼š5-7å¤©

---

## âœ… ä»»åŠ¡åˆ—è¡¨

### ä»»åŠ¡16ï¼šåˆ›å»ºPostMapperå’ŒReplyMapper
- **ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜
- **é¢„è®¡æ—¶é—´**ï¼š6å°æ—¶
- **è´Ÿè´£äºº**ï¼šåç«¯å¼€å‘äººå‘˜
- **çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹

#### å…·ä½“æ­¥éª¤
1. [ ] åˆ›å»º `PostMapper.java` æ¥å£
2. [ ] åˆ›å»º `ReplyMapper.java` æ¥å£
3. [ ] åˆ›å»ºå¯¹åº”çš„XMLæ˜ å°„æ–‡ä»¶
4. [ ] å®ç°å¸–å­CRUDæ–¹æ³•
5. [ ] å®ç°å›å¤CRUDæ–¹æ³•

#### PostMapperæ¥å£
```java
package com.starwar.mapper;

import com.starwar.entity.Post;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import java.util.List;

@Mapper
public interface PostMapper {
    // æ’å…¥å¸–å­
    int insert(Post post);
    
    // æŸ¥è¯¢å¸–å­åˆ—è¡¨
    List<Post> selectList(@Param("offset") Integer offset,
                         @Param("limit") Integer limit);
    
    // æ ¹æ®IDæŸ¥è¯¢å¸–å­
    Post selectById(Long id);
    
    // æ›´æ–°æµè§ˆæ¬¡æ•°
    int updateViewCount(Long id);
    
    // æ›´æ–°å›å¤æ•°
    int updateReplyCount(Long id);
    
    // ç»Ÿè®¡å¸–å­æ€»æ•°
    int count();
}
```

#### ReplyMapperæ¥å£
```java
package com.starwar.mapper;

import com.starwar.entity.Reply;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import java.util.List;

@Mapper
public interface ReplyMapper {
    // æ’å…¥å›å¤
    int insert(Reply reply);
    
    // æŸ¥è¯¢å¸–å­ä¸‹çš„æ‰€æœ‰å›å¤
    List<Reply> selectByPostId(Long postId);
    
    // æŸ¥è¯¢çˆ¶å›å¤
    Reply selectById(Long id);
}
```

---

### ä»»åŠ¡17ï¼šå®ç°PostServiceä¸šåŠ¡é€»è¾‘
- **ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜
- **é¢„è®¡æ—¶é—´**ï¼š1å¤©
- **è´Ÿè´£äºº**ï¼šåç«¯å¼€å‘äººå‘˜
- **çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹

#### å…·ä½“æ­¥éª¤
1. [ ] åˆ›å»º `PostService.java` æ¥å£
2. [ ] åˆ›å»º `impl/PostServiceImpl.java` å®ç°ç±»
3. [ ] å®ç°å‘å¸ƒå¸–å­åŠŸèƒ½
4. [ ] å®ç°æŸ¥è¯¢å¸–å­åˆ—è¡¨åŠŸèƒ½
5. [ ] å®ç°æŸ¥è¯¢å¸–å­è¯¦æƒ…åŠŸèƒ½
6. [ ] å®ç°å¢åŠ æµè§ˆæ¬¡æ•°åŠŸèƒ½

#### PostServiceæ¥å£
```java
package com.starwar.service;

import com.starwar.dto.PostDTO;
import com.starwar.vo.PostVO;
import com.starwar.common.PageResult;

public interface PostService {
    // å‘å¸ƒå¸–å­
    void createPost(Long userId, PostDTO postDTO);
    
    // æŸ¥è¯¢å¸–å­åˆ—è¡¨
    PageResult<PostVO> getPostList(Integer page, Integer size);
    
    // æŸ¥è¯¢å¸–å­è¯¦æƒ…
    PostVO getPostDetail(Long postId);
    
    // å¢åŠ æµè§ˆæ¬¡æ•°
    void incrementViewCount(Long postId);
}
```

---

### ä»»åŠ¡18ï¼šåˆ›å»ºPostController
- **ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜
- **é¢„è®¡æ—¶é—´**ï¼š4å°æ—¶
- **è´Ÿè´£äºº**ï¼šåç«¯å¼€å‘äººå‘˜
- **çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹

#### å…·ä½“æ­¥éª¤
1. [ ] åˆ›å»º `PostController.java`
2. [ ] å®ç°å‘å¸ƒå¸–å­æ¥å£
3. [ ] å®ç°å¸–å­åˆ—è¡¨æ¥å£
4. [ ] å®ç°å¸–å­è¯¦æƒ…æ¥å£
5. [ ] å®ç°å›å¤æ¥å£

#### PostControllerç¤ºä¾‹
```java
package com.starwar.controller;

import com.starwar.dto.PostDTO;
import com.starwar.dto.ReplyDTO;
import com.starwar.service.PostService;
import com.starwar.common.Result;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/v1/post")
public class PostController {
    
    @Autowired
    private PostService postService;
    
    @PostMapping("/create")
    public Result<?> createPost(@RequestHeader("Authorization") String token,
                                @RequestBody PostDTO postDTO) {
        Long userId = getUserIdFromToken(token);
        postService.createPost(userId, postDTO);
        return Result.success(null);
    }
    
    @GetMapping("/list")
    public Result<?> getPostList(@RequestParam(defaultValue = "1") Integer page,
                                 @RequestParam(defaultValue = "10") Integer size) {
        return Result.success(postService.getPostList(page, size));
    }
    
    @GetMapping("/detail/{postId}")
    public Result<?> getPostDetail(@PathVariable Long postId) {
        postService.incrementViewCount(postId);
        return Result.success(postService.getPostDetail(postId));
    }
    
    @PostMapping("/reply")
    public Result<?> reply(@RequestHeader("Authorization") String token,
                          @RequestBody ReplyDTO replyDTO) {
        Long userId = getUserIdFromToken(token);
        postService.reply(userId, replyDTO);
        return Result.success(null);
    }
    
    private Long getUserIdFromToken(String token) {
        return Long.parseLong(token);
    }
}
```

---

### ä»»åŠ¡19ï¼šé…ç½®CORSå’ŒJWTæ‹¦æˆªå™¨
- **ä¼˜å…ˆçº§**ï¼šğŸŸ¡ ä¸­
- **é¢„è®¡æ—¶é—´**ï¼š4å°æ—¶
- **è´Ÿè´£äºº**ï¼šåç«¯å¼€å‘äººå‘˜
- **çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹

#### å…·ä½“æ­¥éª¤
1. [ ] åˆ›å»º `CorsConfig.java` é…ç½®ç±»
2. [ ] åˆ›å»º `JwtInterceptor.java` æ‹¦æˆªå™¨
3. [ ] é…ç½®æ‹¦æˆªè·¯å¾„
4. [ ] æµ‹è¯•è·¨åŸŸå’Œè®¤è¯åŠŸèƒ½

#### CorsConfigé…ç½®
```java
package com.starwar.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class CorsConfig implements WebMvcConfigurer {
    
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/**")
                .allowedOrigins("http://localhost:3000", "http://localhost:8080")
                .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                .allowedHeaders("*")
                .allowCredentials(true);
    }
}
```

#### JwtInterceptoræ‹¦æˆªå™¨
```java
package com.starwar.config;

import com.starwar.util.JwtUtil;
import io.jsonwebtoken.Claims;
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.HandlerInterceptor;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@Component
public class JwtInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        String token = request.getHeader("Authorization");
        
        if (token != null && token.startsWith("Bearer ")) {
            token = token.substring(7);
            try {
                Claims claims = JwtUtil.parseToken(token);
                request.setAttribute("userId", claims.get("userId"));
                return true;
            } catch (Exception e) {
                response.setStatus(401);
                return false;
            }
        }
        
        // æŸäº›æ¥å£ä¸éœ€è¦è®¤è¯ï¼Œå…è®¸é€šè¿‡
        return true;
    }
}
```

---

### ä»»åŠ¡20ï¼šæ‰“åŒ…éƒ¨ç½²å’Œæµ‹è¯•
- **ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜
- **é¢„è®¡æ—¶é—´**ï¼š1å¤©
- **è´Ÿè´£äºº**ï¼šå…¨ä½“æˆå‘˜
- **çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹

#### å…·ä½“æ­¥éª¤
1. [ ] é…ç½®Swagger APIæ–‡æ¡£
2. [ ] ç¼–å†™æ¥å£æµ‹è¯•ç”¨ä¾‹
3. [ ] ä½¿ç”¨Postmanæµ‹è¯•æ‰€æœ‰æ¥å£
4. [ ] æ‰“åŒ…é¡¹ç›®ï¼š`mvn clean package`
5. [ ] éƒ¨ç½²åˆ°TomcatæœåŠ¡å™¨
6. [ ] è¿›è¡Œé›†æˆæµ‹è¯•

#### Swaggeré…ç½®
```java
package com.starwar.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

@Configuration
@EnableSwagger2
public class SwaggerConfig {
    
    @Bean
    public Docket createRestApi() {
        return new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo())
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.starwar.controller"))
                .paths(PathSelectors.any())
                .build();
    }
    
    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title("æ˜Ÿé™…é˜²å«æˆ˜ APIæ–‡æ¡£")
                .description("åç«¯APIæ¥å£æ–‡æ¡£")
                .version("1.0")
                .build();
    }
}
```

#### éƒ¨ç½²æ­¥éª¤
```bash
# 1. æ‰“åŒ…é¡¹ç›®
mvn clean package

# 2. å¤åˆ¶waræ–‡ä»¶åˆ°Tomcat
cp target/star-war-backend-1.0.0.war $TOMCAT_HOME/webapps/

# 3. å¯åŠ¨Tomcat
$TOMCAT_HOME/bin/startup.sh

# 4. è®¿é—®æµ‹è¯•
# http://localhost:8080/star-war-backend-1.0.0/swagger-ui.html
```

---

## ğŸ“Š é˜¶æ®µè¿›åº¦ç»Ÿè®¡

- **å·²å®Œæˆä»»åŠ¡**ï¼š0 / 5
- **è¿›è¡Œä¸­ä»»åŠ¡**ï¼š0 / 5
- **å¾…å¼€å§‹ä»»åŠ¡**ï¼š5 / 5
- **æ•´ä½“è¿›åº¦**ï¼š0%

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **CORSé…ç½®**ï¼šæ ¹æ®å®é™…å‰ç«¯åœ°å€é…ç½®å…è®¸çš„æº
2. **è®¤è¯æ‹¦æˆª**ï¼šåŒºåˆ†éœ€è¦è®¤è¯å’Œä¸éœ€è¦è®¤è¯çš„æ¥å£
3. **Swaggeræ–‡æ¡£**ï¼šç”¨äºæ¥å£æµ‹è¯•å’Œæ–‡æ¡£å±•ç¤º
4. **éƒ¨ç½²æµ‹è¯•**ï¼šç¡®ä¿æ‰€æœ‰åŠŸèƒ½åœ¨ç”Ÿäº§ç¯å¢ƒæ­£å¸¸å·¥ä½œ
5. **æ€§èƒ½æµ‹è¯•**ï¼šæµ‹è¯•å¹¶å‘è®¿é—®èƒ½åŠ›

---

## ğŸ¯ å®Œæˆæ ‡å¿—

å½“ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶æ»¡è¶³æ—¶ï¼Œé˜¶æ®µ5å®Œæˆï¼š
- âœ… è®¨è®ºåŒºåŠŸèƒ½å®Œæ•´å®ç°
- âœ… CORSå’ŒJWTé…ç½®æ­£ç¡®
- âœ… Swaggeræ–‡æ¡£å¯ä»¥è®¿é—®
- âœ… æ‰€æœ‰æ¥å£æµ‹è¯•é€šè¿‡
- âœ… é¡¹ç›®æˆåŠŸéƒ¨ç½²åˆ°Tomcat
- âœ… ç³»ç»Ÿè¿è¡Œç¨³å®š

---

**ä¸Šä¸€é˜¶æ®µ**ï¼š[é˜¶æ®µ4ï¼šæ¸¸æˆè®°å½•æ¨¡å—å¼€å‘](å¼€å‘å¾…åŠæ¸…å•-é˜¶æ®µ4-æ¸¸æˆè®°å½•æ¨¡å—.md)  
**æ–‡æ¡£ç´¢å¼•**ï¼š[å¼€å‘å¾…åŠæ¸…å•æ€»è§ˆ](å¼€å‘å¾…åŠæ¸…å•-æ€»è§ˆ.md)

