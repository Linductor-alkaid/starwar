<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.starwar.mapper.ReplyMapper">
    
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO reply(post_id, user_id, content, parent_id)
        VALUES(#{postId}, #{userId}, #{content}, #{parentId})
    </insert>
    
    <select id="selectByPostId" resultType="com.starwar.entity.Reply">
        SELECT r.*, u.username, u.nickname
        FROM reply r
        LEFT JOIN user u ON r.user_id = u.id
        WHERE r.post_id = #{postId} AND r.status = 1
        ORDER BY r.created_at ASC
    </select>
    
    <select id="selectById" resultType="com.starwar.entity.Reply">
        SELECT * FROM reply WHERE id = #{id}
    </select>
</mapper>

