# 后端开发指南

## 快速开始

### 1. 环境准备

确保已安装：
- JDK 8
- MySQL 8.0
- IntelliJ IDEA（或Eclipse）

### 2. 导入项目

1. 打开IntelliJ IDEA
2. 选择 "File" -> "Open"
3. 选择 `backend` 目录
4. 等待Maven依赖下载完成

### 3. 配置数据库

1. 启动MySQL服务
2. 执行 `docs/database/init.sql` 脚本创建数据库
3. 修改 `src/main/resources/application.yml` 中的数据库配置：
   ```yaml
   spring:
     datasource:
       username: root
       password: 你的MySQL密码
   ```

### 4. 运行项目

1. 找到 `StarWarApplication.java` 主类
2. 右键选择 "Run 'StarWarApplication'"
3. 等待启动完成，看到 "Started StarWarApplication"

### 5. 测试接口

访问 Swagger 文档：http://localhost:8080/swagger-ui.html

## 功能模块详解

### 1. 用户认证模块

#### 注册接口
- **URL**: POST `/api/v1/auth/register`
- **请求体**:
  ```json
  {
    "username": "testuser",
    "password": "123456",
    "email": "test@example.com",
    "nickname": "测试用户"
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "message": "注册成功",
    "data": null
  }
  ```

#### 登录接口
- **URL**: POST `/api/v1/auth/login`
- **请求体**:
  ```json
  {
    "username": "testuser",
    "password": "123456"
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "message": "登录成功",
    "data": {
      "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    }
  }
  ```

### 2. 用户信息模块

#### 获取用户信息
- **URL**: GET `/api/v1/user/info`
- **请求头**: `Authorization: Bearer {token}`
- **响应**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": 1,
      "username": "testuser",
      "nickname": "测试用户",
      "avatar": null,
      "email": "test@example.com"
    }
  }
  ```

### 3. 游戏记录模块

#### 保存游戏记录
- **URL**: POST `/api/v1/game/record`
- **请求头**: `Authorization: Bearer {token}`
- **请求体**:
  ```json
  {
    "score": 1500,
    "level": 5,
    "playTime": 120
  }
  ```

#### 获取历史记录
- **URL**: GET `/api/v1/game/history?page=1&size=10`
- **请求头**: `Authorization: Bearer {token}`

#### 获取排行榜
- **URL**: GET `/api/v1/game/leaderboard?page=1&size=20`

### 4. 讨论区模块

#### 发布帖子
- **URL**: POST `/api/v1/post/create`
- **请求头**: `Authorization: Bearer {token}`
- **请求体**:
  ```json
  {
    "title": "游戏攻略分享",
    "content": "分享一下我的游戏心得..."
  }
  ```

#### 获取帖子列表
- **URL**: GET `/api/v1/post/list?page=1&size=10`

#### 获取帖子详情
- **URL**: GET `/api/v1/post/detail/{postId}`

#### 回复帖子
- **URL**: POST `/api/v1/post/reply`
- **请求头**: `Authorization: Bearer {token}`
- **请求体**:
  ```json
  {
    "postId": 1,
    "content": "说得很好！",
    "parentId": null
  }
  ```

## 开发新功能

### 步骤1：创建实体类
在 `entity` 包下创建对应的实体类。

### 步骤2：创建Mapper
1. 在 `mapper` 包下创建接口
2. 在 `resources/mapper` 包下创建XML文件
3. 定义数据库操作方法

### 步骤3：创建Service
1. 在 `service` 包下创建接口
2. 在 `service/impl` 包下创建实现类
3. 实现业务逻辑

### 步骤4：创建Controller
1. 在 `controller` 包下创建控制器
2. 定义API接口
3. 调用Service层

### 步骤5：测试
使用Swagger或Postman测试接口。

## 注意事项

1. **密码加密**: 使用BCrypt加密，绝不明文存储
2. **Token管理**: JWT Token有效期7天
3. **异常处理**: 使用GlobalExceptionHandler统一处理
4. **返回格式**: 统一使用Result包装返回
5. **参数验证**: 使用@Valid注解验证请求参数

## 常见问题

### Q1: 启动报端口被占用
**A**: 修改 `application.yml` 中的 `server.port` 为其他端口

### Q2: 数据库连接失败
**A**: 检查MySQL服务是否启动，用户名密码是否正确

### Q3: Mapper无法找到
**A**: 检查 `@MapperScan` 注解和mapper.xml位置

### Q4: Lombok注解不生效
**A**: IDEA需要安装Lombok插件并启用注解处理

### Q5: 跨域请求失败
**A**: 检查CorsConfig配置是否正确

## 参考资料

- [Spring Boot官方文档](https://spring.io/projects/spring-boot)
- [MyBatis官方文档](https://mybatis.org/mybatis-3/)
- [MySQL官方文档](https://dev.mysql.com/doc/)

